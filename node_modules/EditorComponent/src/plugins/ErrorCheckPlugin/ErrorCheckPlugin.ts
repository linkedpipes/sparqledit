import { ErrorMessageProvider } from '../../providers/ErrorMessageProvider';
import { IPlugin, IEditorPluginApi } from '../IPlugin';
import { ERSParser } from "ERSParser"

export class ErrorCheckPlugin implements IPlugin {
    init(monacoEditor: monaco.editor.IStandaloneCodeEditor, editorPluginApi: IEditorPluginApi): void {
        var editorModel = monacoEditor.getModel();
        var errorMessageProvider = new ErrorMessageProvider();
        errorMessageProvider.init(monacoEditor);

        monacoEditor.getModel().onDidChangeContent((e) => {
            if (editorPluginApi.editorSettingsStore.getSettings('interactiveMode')) {
                var editorContent = editorModel.getValue();
                var parser = new ERSParser();
                var parserResult = parser.parse(editorContent);
                errorMessageProvider.setEditorErrors(parserResult.recoverableErrors, parserResult.haltingError);
            }
        });
    }
}