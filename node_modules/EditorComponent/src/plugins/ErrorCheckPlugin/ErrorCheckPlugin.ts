import { IEditorPluginApi } from '../EditorPluginApi';
import { ErrorMessageService } from '../../service/ErrorMessageService';
import { IPlugin } from '../IPlugin';
import { ERSParser } from "ERSParser"

export class ErrorCheckPlugin implements IPlugin {

    init(editorPluginApi: IEditorPluginApi): void {
        var monacoEditor = editorPluginApi.getMonacoEditor();
        var editorModel = monacoEditor.getModel();
        var errorMessageService = editorPluginApi.getErrorMessageService();
        monacoEditor.getModel().onDidChangeContent((e) => {
            if (editorPluginApi.getEditorSettings().getSettings('interactiveMode')) {
                var editorContent = editorModel.getValue();
                var parser = new ERSParser();
                var parserResult = parser.parse(editorContent);
                errorMessageService.setEditorErrors(parserResult.recoverableErrors, parserResult.haltingError);
            }
        });
    }
}