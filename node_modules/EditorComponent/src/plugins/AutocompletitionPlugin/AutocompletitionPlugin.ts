import {IEditorPluginApi} from '../EditorPluginApi';
import { IPlugin } from '../IPlugin';
import { MonacoSparqlCompletionItemProvider } from './MonacoSparqlCompletionItemProvider';
import { SparqlSignatureHelpProvider, SparqlLanguageServer } from "SparqlAutocompletion";
import { getSparqlLanguageServer } from '../../service/SparqlLanguageServerService';
export class signatureprovider implements monaco.languages.SignatureHelpProvider {
    signatureHelpTriggerCharacters: string[] = [' '];

    private sparqlAutocompleteProvider: SparqlSignatureHelpProvider;

    constructor(sparqlLanguageServer: SparqlLanguageServer) {
        this.sparqlAutocompleteProvider = sparqlLanguageServer.sparqlSignatureHelpProvider;
    }

    createHackSignatureHelp(label: string, documentation: string): monaco.languages.SignatureHelp {
        return {
            signatures: [{
                label: "Expected",
                parameters: [{
                    documentation: label,
                    label: "label"
                }]
            }],
            activeParameter: 0,
            activeSignature: 0
        }
    }

    provideSignatureHelp(model: monaco.editor.IReadOnlyModel, position: monaco.Position, token: monaco.CancellationToken): monaco.languages.SignatureHelp {
        var signatureHelp = this.sparqlAutocompleteProvider.provideSignatureHelp(model.getValue(), model.getOffsetAt(position));
        if (signatureHelp == null) {
            return null;
        }
        return this.createHackSignatureHelp(signatureHelp.label, signatureHelp.documentation);
    }
}

export class AutocompletitionPlugin implements IPlugin {
    init(editorPluginApi: IEditorPluginApi): void {
        // TODO: remove this nice singleton pattern
        var sparqlLanguageServer = getSparqlLanguageServer();
        monaco.languages.registerCompletionItemProvider('sparql', new MonacoSparqlCompletionItemProvider(sparqlLanguageServer));
        monaco.languages.registerSignatureHelpProvider('sparql', new signatureprovider(sparqlLanguageServer))
    }
}