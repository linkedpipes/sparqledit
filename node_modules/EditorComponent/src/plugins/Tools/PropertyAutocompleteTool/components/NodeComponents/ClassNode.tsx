import * as React from "react";
import { observer } from "mobx-react";
import { observable } from "mobx";
import { OntologyProperty } from "SparqlAutocompletion";
import { CleanOntologyClassTextFormatter } from "SparqlAutocompletion";
import { INodeFactoryContext, BaseNodeFactory } from "./NodeFactory";
import { ExpandableList, ExpandableListItem } from "../ExpandableList";
import { ClassNodeInput, PropertyNodeInput } from "./DataModel";
import * as _ from "lodash";

export interface ClassNodeProps {
    data: ClassNodeInput
    renderListUnder(ontologyProperties: OntologyProperty[]): JSX.Element;
}

export class ClassNodeComponent extends React.Component<ClassNodeProps, any> {
    render() {
        return (
            <ul className="autocompleteclassList">
                {this.props.data.classes.map((autocompleteClass, classIndex) => {
                    var classProperties = autocompleteClass.properties;
                    return (
                        <li key={classIndex} className="autoCompleteClass">
                            <div className="autocompleteClassName">{autocompleteClass.name}</div>
                            {this.props.renderListUnder(classProperties)}
                        </li>)
                })}
            </ul>
        );
    }
}

export class ClassNodeFactory extends BaseNodeFactory<ClassNodeInput, PropertyNodeInput> {
    dataSelector(data: ClassNodeInput, nodeFactoryContext: INodeFactoryContext): PropertyNodeInput {
        var properties = _(data.classes)
            .map(x => x.properties)
            .flatten<OntologyProperty>()
            .value();

        return {
            ontologyProperties: properties
        }
    }

    getListElement(data: ClassNodeInput, nodeFactoryContext: INodeFactoryContext): JSX.Element {
        return <ClassNodeComponent
            data={data}
            renderListUnder={(ontologyProperties) => nodeFactoryContext.renderListUnder(
                {
                    ontologyProperties: ontologyProperties
                })} />
    }
}