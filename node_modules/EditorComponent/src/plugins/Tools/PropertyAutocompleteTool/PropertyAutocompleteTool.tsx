import * as React from "react";
import { IEditorPluginApi } from '../../EditorPluginApi';
import { IPlugin } from '../../IPlugin';
import { Tool } from "../../../store/ToolStore";
import { PropertyAutocompleteComponent } from "./components/PropertyAutocompleteComponent";
import { PropertyAutocompleteOptionsComponent } from "./components/PropertyAutocompleteOptionsComponent";
import { defaultPropertyAutocompleteOptions } from "./PropertyAutocompleteOptions";

export class PropertyAutocompleteTool implements IPlugin {
    init(editorPluginApi: IEditorPluginApi): void {
        var monacoEditor = editorPluginApi.getMonacoEditor();
        function getEditorContentAndCursorPosition() {
            var model = monacoEditor.getModel();
            return {
                content: model.getValue(),
                position: model.getOffsetAt(monacoEditor.getPosition())
            }
        }
        var sparqlLanguageService = editorPluginApi.getSparqlLanguageService();

        editorPluginApi.getToolStore().tools.push(
            new Tool(<div>
                <PropertyAutocompleteOptionsComponent
                    propertyAutocompleteOptions={defaultPropertyAutocompleteOptions} />
                <PropertyAutocompleteComponent
                    monacoEditor={monacoEditor}
                    propertyAutocompleteOptions={defaultPropertyAutocompleteOptions}
                    getEditorContentAndCursorPosition={getEditorContentAndCursorPosition}
                    sparqlLanguageService={sparqlLanguageService} /></div>
            ));
    }
}