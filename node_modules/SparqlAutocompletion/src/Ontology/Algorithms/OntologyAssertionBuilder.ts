import { RdfIri } from '../../Utils/RdfIri';
import { IGraph } from '../../GraphTools/GraphInterfaces';
import { TurtleGraphWrapper } from '../../GraphTools/TurtleGraphWrapper';
import { OntologyClassParser } from '../OntologyClassParser';
import { OntologyAssertions } from '../OntologyAssertions';

export class OntologyAssertionsBuilder {

    private buildOntologyAsertionsOnGraph(graph: IGraph, ontologyAssertions: OntologyAssertions) {
        var ontologyClassParser = new OntologyClassParser(graph);

        var subClassOfGraph = graph.match(null, RdfIri.rdfsSubclassOf, null);
        for (var subClassOfTriple of subClassOfGraph.getTriples()) {
            let subjectOntologyClass = ontologyClassParser.getClassType(subClassOfTriple.subject);
            let objectOntologyClass = ontologyClassParser.getClassType(subClassOfTriple.object);
            ontologyAssertions.addSubclassEdge(subjectOntologyClass, objectOntologyClass);
        }

        var equalClassGraph = graph.match(null, RdfIri.owlEquivalentClass, null);
        for (var equalClassTriple of equalClassGraph.getTriples()) {
            let subjectOntologyClass = ontologyClassParser.getClassType(equalClassTriple.subject);
            let objectOntologyClass = ontologyClassParser.getClassType(equalClassTriple.object);
            ontologyAssertions.addEquivalenceEdge(subjectOntologyClass, objectOntologyClass);
        }

        var domainGraph = graph.match(null, RdfIri.rdfsDomain, null);
        for (var domainTriple of domainGraph.getTriples()) {
            // TODO: add execeptions
            var propertyName = domainTriple.subject.nominalValue;
            var domainOntologyClass = ontologyClassParser.getClassType(domainTriple.object);
            ontologyAssertions.addDomain(propertyName, domainOntologyClass);
        }

        var rangeGraph = graph.match(null, RdfIri.rdfsRange, null);
        for (var rangeTriple of rangeGraph.getTriples()) {
            // TODO: add execeptions
            var propertyName = rangeTriple.subject.nominalValue;
            var rangeOntologyClass = ontologyClassParser.getClassType(rangeTriple.object);
            ontologyAssertions.addRange(propertyName, rangeOntologyClass);
        }

        return ontologyAssertions;
    }

    public buildOntologyAsertions(graph: IGraph) {
        return this.buildOntologyAsertionsMultipleGraphs([graph]);
    }

    public buildOntologyAsertionsMultipleGraphs(graphs: IGraph[]) {
        var ontologyAssertions = new OntologyAssertions();
        for (var graph of graphs) {
            this.buildOntologyAsertionsOnGraph(graph, ontologyAssertions);
        }
        return ontologyAssertions;
    }
}