import { OntologyAutocompleteSubProvider } from '../../../src/Autocompletition/SubProviders/OntologyAutocompleteSubProvider';
import { EmptyLogger } from '../../../src/Logging/Logger';
import { Block, NodeType } from '../../../src/Autocompletition/Query/Query';
import { SparqlLanguageServerSettings } from '../../../src/Autocompletition/SparqlLanguageServerSettings';
import { createOntologyAssertionsFromTurtle } from '../../../test/Utils/Utils';

import { ERSParser } from 'ERSParser';


function parseQuery(queryContent: string) {
    var parser = new ERSParser();
    return parser.parse(queryContent).query;
}

describe('OntologyAutocompleteSubProvider', () => {
    it('should do simple autocomplettion', () => {
        var schemaContent = require('raw-loader!../../TestData/Autocompletition/SubProviders/schema.ttl');
        var queryContent = require('raw-loader!../../TestData/Autocompletition/SubProviders/query.sparql');

        var ontologyAssertions = createOntologyAssertionsFromTurtle(schemaContent);
        var autocompleteProvider = new OntologyAutocompleteSubProvider(new EmptyLogger(), ontologyAssertions, new SparqlLanguageServerSettings({}));
        var query = parseQuery(queryContent);
        var autocompleteResult = autocompleteProvider.provideAutocompleteItems(query);
    })

    describe('Block', () => {
        it('should parse different kinds of nodes.', () => {
            var queryContent = require('raw-loader!../../TestData/Autocompletition/SubProviders/queryBlock.sparql');

            var query: any = parseQuery(queryContent);
            var block = new Block(query.where[0].triples);
            var objects = block.triples.map(x =>
                ({
                    type: NodeType[x.object.type],
                    value: x.object.value
                }));
        })
    });
})